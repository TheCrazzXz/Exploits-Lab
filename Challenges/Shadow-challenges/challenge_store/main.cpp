#include "core.h"
#include <vector>
#define INITIAL_MONEY 1500

void printMoney(Client client)
{
	std::cout << "Your current money amount : " << client.getMoneyAmount() << "$" << std::endl;
}

int main()
{
	Client client(INITIAL_MONEY);

	std::vector<StoreItem> items;
	items.push_back({"Fast Computer", 900});
	items.push_back({"Really slow computer", 150});
	items.push_back({"Iphone 25", 2500});
	items.push_back({"Xprotox gadget", 99999});

	std::cout << "Welcome to the store ultra++ secure" << std::endl;

	while(true)
	{
		std::cout << "[0] : Exit store" << std::endl;
		int i = 1;
		for(StoreItem it : items)
		{
			std::cout << "[" << i << "]" << " Buy the " << it.name << " (price : " << it.price << ")" << std::endl;
			i++;
		}

		printMoney(client);

		int choice;
		std::cout << "Enter item number to buy : ";
		std::cin >> choice;
		std::cout << "DEBUG : choice : " << choice << std::endl;
		if(choice > items.size())
		{
			std::cerr << "Error : choice is out of range" << std::endl;
			exit(-1);
		}

		if(choice == 0)
		{
			exit(0);
		}
		else
		{
			int noItem;
			std::cout << "How many " << items[choice - 1].name << "s do you wanna buy ? : ";
			std::cin >> noItem;

			if(noItem < 0)
			{
				std::cerr << "Error : You can't buy a negative amount of this item... Unfortunaly...\n" << std::endl;
				exit(-2);
			}

			int result = client.buy(items[choice - 1], noItem);

			if(result == 1)
			{
				if(noItem == 1)
				{
					std::cout << "Thank you ! You bought the " << items[choice - 1].name << std::endl;
				}
				else
				{
					std::cout << "Thank you ! You bought " << noItem << " " << items[choice - 1].name << "s" << std::endl;
				}
			}
			else
			{
				std::cout << "Can't continue : Not enough money in your account to buy this" << std::endl;
				std::cout << "You need " << (items[choice - 1].price * noItem) - client.getMoneyAmount() << " more dollars to buy this item" << std::endl;
			}
		}

	}
	
}