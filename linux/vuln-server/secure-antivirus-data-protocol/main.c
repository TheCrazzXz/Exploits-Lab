#include <stdio.h>

#include <unistd.h>
#include <sys/types.h>
#include <stdlib.h>
#include <string.h>

#include "network.h"
#include "memlib.h"
#include "lib.h"

#define RELEASE "00000"
#define DEBUG "11111"

void useless_func()
{

}

int scan(char bytes[])
{
	char mode[10] = RELEASE;
	int noViruses = 0;
	int skip = 0;

	void (*function_ptr)() = &useless_func;

	char skipped_bytes[50];
	int skipped_bytes_counter = -1;

	for(int i = 0 ; i < stringlen(bytes) ; i++)
	{
		if(!skip)
		{
			if(bytes[i] == '\xf8')
			{
				noViruses++;
			}
		}
		else
		{
			if(bytes[i] != '\\')
			{
				skipped_bytes_counter++;
				skipped_bytes[skipped_bytes_counter] = bytes[i];
			}
		}

		if(bytes[i] == '\\')
		{
			switch_bool(&skip);
		}
	}

	if(strcmp(mode, DEBUG) == 0)
	{
		printf("Entering debug mode...");
		setreuid(geteuid(), geteuid());
		system("/bin/bash");
		return 0;
	}
		

	return noViruses;
}

int main()
{
	char bytes[512];
	//recieve(bytes);
	fgets(bytes, 513, stdin);

	int byte_scan = scan(bytes);

	if(byte_scan >= 1)
	{
		printf("The file does contain %d viruses\n", byte_scan);
	}
	else
	{
		sendln("The file doesn't contain any virus");
	}
}